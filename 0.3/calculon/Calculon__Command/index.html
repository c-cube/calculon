<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Calculon__Command (calculon.Calculon__Command)</title><link rel="stylesheet" href="../../odoc.css"/><meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div class="content"><header><nav><a href="../index.html">Up</a> â€“ <a href="../index.html">calculon</a> &#x00BB; Calculon__Command</nav><h1>Module <code>Calculon__Command</code></h1><h2 id="command-type"><a href="#command-type" class="anchor"></a>Command Type</h2><p>A command is a particular rule for reacting to what is said on IRC. Typically, a command takes a <span class="xref-unresolved" title="unresolved reference to &quot;Core.t&quot;"><code>Core</code>.t</span> (to be able to answer and perform IRC actions) and an input message, and it decides whether to do something or not based on the message.</p><p>The command returns a <a href="index.html#type-res"><code>res</code></a>, which specifies whether it successfully &quot;caught&quot; the message (no need then for other commands to run), if it didn't react (&quot;skip&quot;) so we can try the other commands, or whether it failed when trying to answer.</p></header><dl><dt class="spec type" id="type-res"><a href="#type-res" class="anchor"></a><code><span class="keyword">type </span>res</code><code><span class="keyword"> = </span></code><table class="variant"><tr id="type-res.Cmd_match" class="anchored"><td class="def constructor"><a href="#type-res.Cmd_match" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Cmd_match</span><span class="keyword"> of </span>unit Lwt.t</code></td><td class="doc"><p>command applies, and fired with given action</p></td></tr><tr id="type-res.Cmd_skip" class="anchored"><td class="def constructor"><a href="#type-res.Cmd_skip" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Cmd_skip</span></code></td><td class="doc"><p>the command did not apply</p></td></tr><tr id="type-res.Cmd_fail" class="anchored"><td class="def constructor"><a href="#type-res.Cmd_fail" class="anchor"></a><code><span class="keyword">| </span></code><code><span class="constructor">Cmd_fail</span><span class="keyword"> of </span>string</code></td><td class="doc"><p>command applies, but failed</p></td></tr></table></dt><dt class="spec type" id="type-t"><a href="#type-t" class="anchor"></a><code><span class="keyword">type </span>t</code><code><span class="keyword"> = </span></code><code>{</code><table class="record"><tr id="type-t.prio" class="anchored"><td class="def field"><a href="#type-t.prio" class="anchor"></a><code>prio : int;</code></td><td class="doc"><p>Priority. The lower, the more urgent this command is.</p></td></tr><tr id="type-t.match_" class="anchored"><td class="def field"><a href="#type-t.match_" class="anchor"></a><code>match_ : <a href="../Calculon/Core/index.html#type-t">Calculon.Core.t</a> <span>&#45;&gt;</span> <a href="../Calculon/Core/index.html#type-privmsg">Calculon.Core.privmsg</a> <span>&#45;&gt;</span> <a href="index.html#type-res">res</a>;</code></td><td class="doc"><p>How to react to incoming messages</p></td></tr><tr id="type-t.name" class="anchored"><td class="def field"><a href="#type-t.name" class="anchor"></a><code>name : string;</code></td><td class="doc"><p>Name of the command</p></td></tr><tr id="type-t.descr" class="anchored"><td class="def field"><a href="#type-t.descr" class="anchor"></a><code>descr : string;</code></td><td class="doc"><p>For !help</p></td></tr></table><code>}</code></dt><dd><p>A command, bundling some metadata (name + descr, used for &quot;!help&quot;), a priority (used to run some commands before the others), and the answering function itself</p></dd></dl><dl><dt class="spec value" id="val-match_prefix1"><a href="#val-match_prefix1" class="anchor"></a><code><span class="keyword">val </span>match_prefix1 : prefix:string <span>&#45;&gt;</span> cmd:string <span>&#45;&gt;</span> <a href="../Calculon/Core/index.html#type-privmsg">Calculon.Core.privmsg</a> <span>&#45;&gt;</span> string option</code></dt><dd><p><code>match_prefix1 ~prefix:&quot;foo&quot; msg</code></p><ul><li>if <code>msg=&quot;!foo bar&quot;</code>, returns <code>Some bar</code></li><li>if <code>msg=&quot;!something else&quot;</code>, returns <code>None</code></li></ul></dd></dl><dl><dt class="spec value" id="val-extract_hl"><a href="#val-extract_hl" class="anchor"></a><code><span class="keyword">val </span>extract_hl : string <span>&#45;&gt;</span> (string<span class="keyword"> * </span>string) option</code></dt><dd><p><code>extract_hl &quot;foo &gt; bar&quot;</code> returns <code>Some (&quot;foo&quot;, &quot;bar&quot;)</code>. Returns <code>None</code> if it cannot split on &quot;&gt;&quot; cleanly.</p></dd></dl><dl><dt class="spec value" id="val-match_prefix1_full"><a href="#val-match_prefix1_full" class="anchor"></a><code><span class="keyword">val </span>match_prefix1_full : prefix:string <span>&#45;&gt;</span> cmd:string <span>&#45;&gt;</span> <a href="../Calculon/Core/index.html#type-privmsg">Calculon.Core.privmsg</a> <span>&#45;&gt;</span> (string<span class="keyword"> * </span>string option) option</code></dt><dt class="spec value" id="val-make"><a href="#val-make" class="anchor"></a><code><span class="keyword">val </span>make : ?&#8288;descr:string <span>&#45;&gt;</span> ?&#8288;prio:int <span>&#45;&gt;</span> name:string <span>&#45;&gt;</span> (<a href="../Calculon/Core/index.html#type-t">Calculon.Core.t</a> <span>&#45;&gt;</span> <a href="../Calculon/Core/index.html#type-privmsg">Calculon.Core.privmsg</a> <span>&#45;&gt;</span> <a href="index.html#type-res">res</a>) <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p>Make a command using the given methods. Only the name and matching rules are requested</p></dd></dl><dl><dt class="spec exception" id="exception-Fail"><a href="#exception-Fail" class="anchor"></a><code><span class="keyword">exception </span></code><code><span class="exception">Fail</span><span class="keyword"> of </span>string</code></dt></dl><dl><dt class="spec value" id="val-make_simple"><a href="#val-make_simple" class="anchor"></a><code><span class="keyword">val </span>make_simple : ?&#8288;descr:string <span>&#45;&gt;</span> ?&#8288;prio:int <span>&#45;&gt;</span> ?&#8288;prefix:string <span>&#45;&gt;</span> cmd:string <span>&#45;&gt;</span> (<a href="../Calculon/Core/index.html#type-privmsg">Calculon.Core.privmsg</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> string option Lwt.t) <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>make_simple ~pre f</code> matches messages of the form &quot;!pre xxx&quot;, and call <code>f msg &quot;xxx&quot;</code>. The function returns 0 or 1 line to reply to sender. The function can raise Fail to indicate failure</p></dd></dl><dl><dt class="spec value" id="val-make_simple_l"><a href="#val-make_simple_l" class="anchor"></a><code><span class="keyword">val </span>make_simple_l : ?&#8288;descr:string <span>&#45;&gt;</span> ?&#8288;prio:int <span>&#45;&gt;</span> ?&#8288;prefix:string <span>&#45;&gt;</span> cmd:string <span>&#45;&gt;</span> (<a href="../Calculon/Core/index.html#type-privmsg">Calculon.Core.privmsg</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> string list Lwt.t) <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p>Same as <a href="index.html#val-make_simple"><code>make_simple</code></a> but replies lines The function can raise Fail to indicate failure</p></dd></dl><dl><dt class="spec value" id="val-make_simple_query_l"><a href="#val-make_simple_query_l" class="anchor"></a><code><span class="keyword">val </span>make_simple_query_l : ?&#8288;descr:string <span>&#45;&gt;</span> ?&#8288;prio:int <span>&#45;&gt;</span> ?&#8288;prefix:string <span>&#45;&gt;</span> cmd:string <span>&#45;&gt;</span> (<a href="../Calculon/Core/index.html#type-privmsg">Calculon.Core.privmsg</a> <span>&#45;&gt;</span> string <span>&#45;&gt;</span> string list Lwt.t) <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p>Same as <a href="index.html#val-make_simple_l"><code>make_simple_l</code></a> but replies lines in query (private) The function can raise Fail to indicate failure</p></dd></dl><dl><dt class="spec value" id="val-compare_prio"><a href="#val-compare_prio" class="anchor"></a><code><span class="keyword">val </span>compare_prio : <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> <span>&#45;&gt;</span> int</code></dt><dd><p>Compare by priority. Used to sort a list of commands by their priority.</p></dd></dl><dl><dt class="spec value" id="val-cmd_help"><a href="#val-cmd_help" class="anchor"></a><code><span class="keyword">val </span>cmd_help : prefix:string <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> list <span>&#45;&gt;</span> <a href="index.html#type-t">t</a></code></dt><dd><p><code>cmd_help ~prefix l</code> build a command <code>[prefix]help</code> that print a help message about plugins in l.</p></dd></dl><dl><dt class="spec value" id="val-run"><a href="#val-run" class="anchor"></a><code><span class="keyword">val </span>run : <a href="../Calculon/Core/index.html#type-t">Calculon.Core.t</a> <span>&#45;&gt;</span> <a href="index.html#type-t">t</a> list <span>&#45;&gt;</span> <a href="../Calculon/Core/index.html#type-privmsg">Calculon.Core.privmsg</a> <span>&#45;&gt;</span> unit Lwt.t</code></dt><dd><p>Execute the commands, in given order, on the message. First command to succeed shortcuts the other ones.</p></dd></dl></div></body></html>