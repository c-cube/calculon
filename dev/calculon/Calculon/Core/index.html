<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"><head><title>Core (calculon.Calculon.Core)</title><link rel="stylesheet" href="../../../odoc.css"/><meta charset="utf-8"/><meta name="generator" content="odoc 2.1.0"/><meta name="viewport" content="width=device-width,initial-scale=1.0"/><script src="../../../highlight.pack.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body class="odoc"><nav class="odoc-nav"><a href="../index.html">Up</a> â€“ <a href="../../index.html">calculon</a> &#x00BB; <a href="../index.html">Calculon</a> &#x00BB; Core</nav><header class="odoc-preamble"><h1>Module <code><span>Calculon.Core</span></code></h1></header><nav class="odoc-toc"><ul><li><a href="#core-irc-state">Core IRC state</a></li></ul></nav><div class="odoc-content"><h2 id="core-irc-state"><a href="#core-irc-state" class="anchor"></a>Core IRC state</h2><div class="odoc-spec"><div class="spec type" id="type-irc_msg" class="anchored"><a href="#type-irc_msg" class="anchor"></a><code><span><span class="keyword">type</span> irc_msg</span><span> = <span class="xref-unresolved">Irc_message</span>.t</span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-privmsg" class="anchored"><a href="#type-privmsg" class="anchor"></a><code><span><span class="keyword">type</span> privmsg</span><span> = </span><span>{</span></code><table><tr id="type-privmsg.nick" class="anchored"><td class="def record field"><a href="#type-privmsg.nick" class="anchor"></a><code><span>nick : string;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>author: nick</p><span class="comment-delim">*)</span></td></tr><tr id="type-privmsg.to_" class="anchored"><td class="def record field"><a href="#type-privmsg.to_" class="anchor"></a><code><span>to_ : string;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>target: nick or chan</p><span class="comment-delim">*)</span></td></tr><tr id="type-privmsg.message" class="anchored"><td class="def record field"><a href="#type-privmsg.message" class="anchor"></a><code><span>message : string;</span></code></td><td class="def-doc"><span class="comment-delim">(*</span><p>actual content</p><span class="comment-delim">*)</span></td></tr></table><code><span>}</span></code></div><div class="spec-doc"><p>A message sent on some IRC channel, or in query. The message content is <code>message</code>, its sender is <code>nick</code> (a nickname), and its target is <code>to_</code> (either a nickname for private messages, or a channel name).</p></div></div><div class="odoc-spec"><div class="spec value" id="val-is_chan" class="anchored"><a href="#val-is_chan" class="anchor"></a><code><span><span class="keyword">val</span> is_chan : <span>string <span class="arrow">&#45;&gt;</span></span> bool</span></code></div><div class="spec-doc"><p>Is this a valid chan name?</p></div></div><div class="odoc-spec"><div class="spec value" id="val-reply_to" class="anchored"><a href="#val-reply_to" class="anchor"></a><code><span><span class="keyword">val</span> reply_to : <span><a href="#type-privmsg">privmsg</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>find whom to reply to. If the message is in query, that is, <code>not (is_chan msg.to_)</code>, then reply to <code>msg.nick</code>; otherwise reply on the channel <code>msg.to_</code>.</p></div></div><div class="odoc-spec"><div class="spec value" id="val-nick" class="anchored"><a href="#val-nick" class="anchor"></a><code><span><span class="keyword">val</span> nick : <span><a href="#type-privmsg">privmsg</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div><div class="spec-doc"><p>The author of the message</p></div></div><div class="odoc-spec"><div class="spec value" id="val-privmsg_of_msg" class="anchored"><a href="#val-privmsg_of_msg" class="anchor"></a><code><span><span class="keyword">val</span> privmsg_of_msg : <span><a href="#type-irc_msg">irc_msg</a> <span class="arrow">&#45;&gt;</span></span> <span><a href="#type-privmsg">privmsg</a> option</span></span></code></div><div class="spec-doc"><p>Try to parse a <a href="#type-privmsg"><code>privmsg</code></a> from a raw IRC message</p></div></div><div class="odoc-spec"><div class="spec value" id="val-string_of_privmsg" class="anchored"><a href="#val-string_of_privmsg" class="anchor"></a><code><span><span class="keyword">val</span> string_of_privmsg : <span><a href="#type-privmsg">privmsg</a> <span class="arrow">&#45;&gt;</span></span> string</span></code></div></div><div class="odoc-spec"><div class="spec module-type" id="module-type-S" class="anchored"><a href="#module-type-S" class="anchor"></a><code><span><span class="keyword">module</span> <span class="keyword">type</span> <a href="module-type-S/index.html">S</a></span><span> = <span class="keyword">sig</span> ... <span class="keyword">end</span></span></code></div></div><div class="odoc-spec"><div class="spec type" id="type-t" class="anchored"><a href="#type-t" class="anchor"></a><code><span><span class="keyword">type</span> t</span><span> = <span>(<span class="keyword">module</span> <a href="module-type-S/index.html">S</a>)</span></span></code></div></div><div class="odoc-spec"><div class="spec value" id="val-loop_ssl" class="anchored"><a href="#val-loop_ssl" class="anchor"></a><code><span><span class="keyword">val</span> loop_ssl : 
  <span>?conn_info:string <span class="arrow">&#45;&gt;</span></span>
  <span>connect:<span>( <span>unit <span class="arrow">&#45;&gt;</span></span> <span><span><span class="xref-unresolved">Irc_client_lwt_ssl</span>.connection_t option</span> <span class="xref-unresolved">Lwt</span>.t</span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span>init:<span>( <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Feed this to <code>Lwt_main</code>.run. It will connect using <code>connect</code> (which opens a TLS connection), create a new core object (of type <a href="#type-t"><code>t</code></a>), call <code>init</code> on this core object (to initialize plugins, etc.) then loop on incoming messages. If the connection is closed for any reason, this will wait for some time and then re-connect and call <code>init</code> again, etc.</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">conn_info</span> <p>how to display connection info in debug messages</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-loop_unsafe" class="anchored"><a href="#val-loop_unsafe" class="anchor"></a><code><span><span class="keyword">val</span> loop_unsafe : 
  <span>?conn_info:string <span class="arrow">&#45;&gt;</span></span>
  <span>connect:<span>( <span>unit <span class="arrow">&#45;&gt;</span></span> <span><span><span class="xref-unresolved">Irc_client_lwt</span>.connection_t option</span> <span class="xref-unresolved">Lwt</span>.t</span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span>init:<span>( <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span> )</span> <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="arrow">&#45;&gt;</span></span>
  <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Feed to <code>Lwt_main</code>.run. Same as <code>loop_tls</code> but with a cleartext connection (boo!).</p><ul class="at-tags"><li class="parameter"><span class="at-tag">parameter</span> <span class="value">conn_info</span> <p>how to display connection info in debug messages</p></li></ul></div></div><div class="odoc-spec"><div class="spec value" id="val-run" class="anchored"><a href="#val-run" class="anchor"></a><code><span><span class="keyword">val</span> run : <span><a href="../Config/index.html#type-t">Config.t</a> <span class="arrow">&#45;&gt;</span></span> <span>init:<span>( <span><a href="#type-t">t</a> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span> )</span> <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="arrow">&#45;&gt;</span></span> <span>unit <span class="xref-unresolved">Lwt</span>.t</span></span></code></div><div class="spec-doc"><p>Main entry point: use config to pick the connection method, then call the appropriate auto-reconnection loop. Calls <code>init</code> every time a new connection is opened.</p></div></div><p>Logging</p><div class="odoc-spec"><div class="spec value" id="val-logs_src" class="anchored"><a href="#val-logs_src" class="anchor"></a><code><span><span class="keyword">val</span> logs_src : <span class="xref-unresolved">Logs</span>.Src.t</span></code></div><div class="spec-doc"><p>Logs from Calculon should use this source.</p><ul class="at-tags"><li class="since"><span class="at-tag">since</span> 0.6</li></ul></div></div><div class="odoc-spec"><div class="spec module" id="module-Log" class="anchored"><a href="#module-Log" class="anchor"></a><code><span><span class="keyword">module</span> Log</span><span> : <span class="xref-unresolved">Logs</span>.LOG</span></code></div><div class="spec-doc"><p>Logger using <a href="#val-logs_src"><code>logs_src</code></a>.</p></div></div></div></body></html>